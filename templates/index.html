<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BBR Weather Report for Deer Hunters</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  background: #0b0b0b;
  color: #eaeaea;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

header {
  padding: 20px;
  text-align: center;
}

h1 {
  color: #ff6600;
  margin-bottom: 10px;
}

/* ZIP INPUT */
.zip-wrap {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-bottom: 15px;
}

.zip-wrap input {
  background: #111;
  color: #fff;
  border: 1px solid #ff6600;
  border-radius: 6px;
  padding: 12px 14px;
  width: 300px;
  font-size: 18px;
}

.zip-wrap input::placeholder {
  color: #888;
}

.zip-wrap button {
  background: #ff6600;
  color: #000;
  border: none;
  border-radius: 6px;
  padding: 8px 14px;
  font-weight: bold;
  cursor: pointer;
}

.zip-wrap button:hover {
  background: #ff7a1a;
}

/* TOGGLES */
.toggle-bar {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 15px;
}

.toggle-bar button {
  background: #1a1a1a;
  color: #fff;
  border: 1px solid #333;
  padding: 6px 14px;
  border-radius: 6px;
  cursor: pointer;
}

.toggle-bar button.active {
  background: #ff6600;
  color: #000;
  border-color: #ff6600;
}

/* CARDS */
.card {
  max-width: 900px;
  margin: 0 auto 20px;
  background: #222;
  border: 1px solid #ff6600;
  border-radius: 10px;
  padding: 16px;
}

.card h2 {
  margin-top: 0;
  color: #ff6600;
}

/* NOW GRID */
.now-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 14px;
  margin-top: 10px;
}

.label {
  color: #aaa;
  font-size: 12px;
}

.value {
  font-size: 16px;
  font-weight: 600;
}

/* TABLE */
table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 8px;
  border-bottom: 1px solid #333;
  text-align: left;
}

th {
  color: #ff6600;
  font-weight: 600;
}
/* LIGHT STACK (NOW CARD RIGHT SIDE) */
.light-stack {
  display: flex;
  flex-direction: column;
  gap: 12px;
  text-align: center;
}

.light-pair {
  display: flex;
  justify-content: center;
  gap: 28px;
}

.light-single {
  text-align: center;
}
.light-panel {
  display: grid;
  grid-template-columns: auto auto;
  column-gap: 18px;
  row-gap: 8px;
  align-items: center;
}

.light-panel .label {
  text-align: right;
}

.light-panel .value {
  text-align: left;
}

/* divider + emphasis for total daylight */
.light-divider {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid #333;
}

.wind-arrow {
  display: inline-block;
  font-size: 14px;
  color: #ff6600;
  margin-right: 6px;
  transform-origin: center;
}
.alert-item {
  margin-top: 10px;
  padding-left: 10px;
  border-left: 4px solid #ffcc00;
}

.alert-warning { border-left-color: #cc0000; }
.alert-watch   { border-left-color: #ff6600; }
.alert-advisory{ border-left-color: #ffcc00; }

.alert-item small {
  color: #aaa;
  font-size: 12px;
}

/* =========================
   MOBILE TABLE FIX (iOS)
   ========================= */
@media (max-width: 600px) {

  /* turn table into block layout */
  table,
  thead,
  tbody,
  tr,
  th,
  td {
    display: block;
    width: 100%;
  }

  /* hide table header */
  thead,
  th {
    display: none;
  }

  /* card-style rows */
  tr {
    background: #1a1a1a;
    border: 1px solid #333;
    border-radius: 8px;
    margin-bottom: 12px;
    padding: 10px;
  }

  td {
    padding: 6px 0;
    border: none;
    font-size: 14px;
  }

  /* labels before values */
  td::before {
    content: attr(data-label);
    display: block;
    font-size: 12px;
    color: #ff6600;
    margin-bottom: 2px;
  }

}
/* =========================
   MOBILE FIXES (iOS / Android)
   ========================= */
@media (max-width: 600px) {

 
  /* cards */
 

  /* reduce heading size */
  h1 {
    font-size: 24px;
  }

  /* shrink form */
  form input[type="text"],
  form select,
  form button {
    font-size: 16px;
    padding: 10px;
  }

}
@media (max-width: 600px) {

 

  /* hide less-important columns */
  .col-pressure,
  .col-gust {
    display: none;
  }

}
@media (max-width: 600px) {

  /* reduce vertical spacing */
  .row {
    margin-bottom: 12px;
  }

 

}
* {
  box-sizing: border-box;

}

@media (max-width: 600px) {

  /* turn NOW into a dashboard */
  .now-grid {
    grid-template-columns: 1fr auto;
    align-items: start;
  }

  /* compass moves top-right */
  .now-grid svg {
    width: 68px;
    height: 68px;
    margin: 0;
    grid-column: 2;
    grid-row: 1 / span 2;
  }

  /* sun/light info becomes compact panel */
  .light-panel {
    grid-column: 1 / -1;
    grid-template-columns: 1fr 1fr;
    font-size: 13px;
    row-gap: 6px;
  }

}

@media (max-width: 600px) {

  #hourly-table tr {
    display: grid;
    grid-template-columns: 1fr auto;
    row-gap: 4px;
  }

  #hourly-table td {
    padding: 2px 0;
  }

  #hourly-table td[data-label="Time"] {
    font-weight: 600;
  }

  #hourly-table td[data-label="Temp"] {
    text-align: right;
    font-weight: 700;
  }

  #hourly-table td[data-label="Wind"] {
    grid-column: 2;
    text-align: right;
    font-size: 13px;
  }

  #hourly-table td[data-label="Conditions"] {
    grid-column: 1;
    font-size: 13px;
  }

  #hourly-table td[data-label="Pressure"] {
    grid-column: 1 / -1;
    font-size: 13px;
    opacity: 0.85;
  }

}
@media (max-width: 600px) {

  #ten-day-table tr {
    display: grid;
    grid-template-columns: 1fr auto;
    row-gap: 4px;
  }

  #ten-day-table td[data-label="Day / Date"] {
    grid-column: 1 / -1;
    font-weight: 600;
  }

  #ten-day-table td[data-label="High"],
  #ten-day-table td[data-label="Low"] {
    grid-column: 1;
  }

  #ten-day-table td[data-label="Wind"],
  #ten-day-table td[data-label="Moon"] {
    grid-column: 2;
    text-align: right;
    font-size: 13px;
  }

  #ten-day-table td[data-label="Conditions"] {
    grid-column: 1 / -1;
    font-size: 13px;
    opacity: 0.9;
  }

}

@media (max-width: 600px) {

  /* tighten NOW card vertically */
  #view-now.card {
    padding: 12px;
  }

  /* slightly reduce gaps */
  .now-grid {
    gap: 10px;
  }

  /* make compass slightly smaller on phones */
  .now-grid svg {
    width: 60px;
    height: 60px;
  }

}

@media (max-width: 600px) {

  /* Make cards full-width on phones */
  .card {
    max-width: 100%;
    width: 100%;
    margin-left: 0;
    margin-right: 0;
    border-radius: 8px;
  }

  /* Slightly reduce side padding so it feels wider */
  #view-hourly.card {
    padding-left: 12px;
    padding-right: 12px;
  }

}
@media (max-width: 600px) {

  /* Let content go edge-to-edge on phones */
  header {
    padding-left: 12px;
    padding-right: 12px;
  }
}
 

</style>
</head>

<body>

<header>
  <h1>BBR Weather Report for Deer Hunters</h1>

  <form class="zip-wrap" onsubmit="getWeather(); return false;">
  <input
    type="text"
    id="zip"
    placeholder="ENTER ZIP CODE"
    maxlength="5"
    inputmode="numeric"
  >
  <button type="submit">SUBMIT</button>
</form>


  <div class="toggle-bar">
    <button id="btn-today" class="active" onclick="showView('today')">TODAY</button>
    <button id="btn-hourly" onclick="showView('hourly')">HOURLY</button>
    <button id="btn-10day" onclick="showView('10day')">10-DAY</button>
  </div>
</header>

<!-- TODAY -->
<div id="view-today">

  <!-- CURRENT CONDITIONS -->
  <div class="card">
    <h2>Current Conditions</h2>
    <div class="now-grid" id="current-content"></div>
  </div>

  <!-- TODAY CONDITIONS -->
  <div class="card">
  <h2>Today‚Äôs Conditions</h2>
  <div class="now-grid" id="today-content"></div>
  <div id="storm-content" style="margin-top:12px; display:none;"></div>
</div>


</div>

<!-- WEATHER ALERTS -->
<div id="alert-card" class="card" style="display:none;">
  <h2>
    ‚ö† Weather Alerts
    <span id="alert-count"
          style="color:#aaa;font-size:13px;"></span>
  </h2>
  <div id="alert-body"></div>
</div>
<!-- HOURLY -->
<div id="view-hourly" class="card" style="display:none">
  <h2>Hourly Forecast</h2>
  <table id="hourly-table"></table>
</div>

<!-- 10 DAY -->
<div id="view-10day" class="card" style="display:none">
  <h2>10-Day Outlook</h2>
  <table id="ten-day-table"></table>
</div>

<script>

function showView(view) {
  ["today","hourly","10day"].forEach(v => {
    const viewEl = document.getElementById(`view-${v}`);
    const btnEl  = document.getElementById(`btn-${v}`);

    if (viewEl) viewEl.style.display = (v === view) ? "block" : "none";
    if (btnEl)  btnEl.classList.toggle("active", v === view);
  });

  // Alerts only show on TODAY
  const alertCard = document.getElementById("alert-card");
  if (alertCard) {
    alertCard.style.display = (view === "today") ? "block" : "none";
  }
}



function timeOnly(dtStr) {
  if (!dtStr) return "";

  if (dtStr.includes("T")) {
    const t = dtStr.split("T")[1] || "";
    return t.slice(0, 5);
  }

  return dtStr.slice(0, 5);
}

// ===============================
// CONDITIONS GLOSSARY (CANONICAL)
// ===============================
const CONDITIONS_DEFINITIONS = {
  "Snow early, overcast later":
    "Snow occurs mainly during the early morning hours and ends. The remainder of the day is dry with persistent cloud cover.",

  "Snow early, clearing later":
    "Snow ends early in the day, followed by decreasing cloud cover and improving sky conditions later.",

  "Intermittent snow showers":
    "Snow occurs in short, scattered periods with dry breaks in between. Snowfall is not continuous.",

  "Snow at times":
    "Snow appears multiple times during the day without a clearly defined start or end period. Conditions are mixed and variable.",

  "Snow tapering off late":
    "Snow continues through part of the day and gradually diminishes, ending later in the afternoon or early evening.",

  "Snow developing later":
    "Conditions are dry early in the day, with snow beginning during the afternoon or early evening hours.",

  "Snow developing overnight":
    "Daytime conditions are mostly dry. Snow begins after sunset or during the overnight period.",

  "Persistent snow":
    "Snow is present for most or all of the daylight hours with minimal or no extended breaks.",

  "Overcast":
    "Cloud cover dominates the entire day with little or no direct sunlight and no significant precipitation.",

  "Mostly cloudy":
    "Clouds cover most of the sky, with occasional brief breaks or thinning.",

  "Cloudy early, clearing later":
    "Cloud cover is more prominent during the morning hours, with gradual clearing as the day progresses.",

  "Clearing late":
    "Clouds dominate most of the day, with noticeable clearing occurring late in the afternoon or near sunset.",

  "Rain early, clearing later":
    "Rain occurs early in the day and ends, followed by drier conditions later.",

  "Rain at times":
    "Rain occurs intermittently throughout the day with dry periods between rainfall.",

  "Rain tapering off late":
    "Rain continues through part of the day and gradually diminishes, ending later in the afternoon or evening.",

  "Rain developing later":
    "Conditions are dry early in the day, with rain beginning during the afternoon or early evening.",

  "Rain developing overnight":
    "Daytime conditions are mostly dry. Rain begins after sunset or during the overnight period.",

  "Persistent rain":
    "Rain is present for most or all of the daylight hours with minimal or no extended breaks.",

  "Clear":
    "Skies are mostly clear throughout the day with minimal cloud cover and no precipitation.",

  "Mostly clear":
    "Skies are generally clear with occasional cloud cover, but clouds do not dominate the day.",

  "Mixed conditions":
    "Weather conditions vary throughout the day without a dominant or clearly classifiable pattern."
};

function summarizeDayConditions(hours) {
  if (!hours || hours.length === 0) {
    return "Mixed conditions";
  }
  

  const snow = [];
  const rain = [];
  const clear = [];
  const cloudy = [];

  hours.forEach(h => {
    const c = h.conditions.toLowerCase();
    const hour = parseInt(h.time.split(":")[0], 10);

    if (c.includes("snow")) snow.push(hour);
    else if (c.includes("rain")) rain.push(hour);
    else if (c.includes("clear")) clear.push(hour);
    else cloudy.push(hour);
  });

  const hasSnow = snow.length > 0;
  const hasRain = rain.length > 0;

  const snowEarly = snow.some(h => h < 9);
  const snowLate  = snow.some(h => h >= 15);
  const snowDay   = snow.some(h => h >= 6 && h <= 18);

  // ---------- SNOW ----------
  if (hasSnow) {
    if (snowEarly && clear.length > 0) {
		return "Snow early, clearing later";
	}
	if (snowEarly && !snowLate && snow.length <= 4) {
	  return "Snow early, overcast later";
	}

    if (!snowEarly && snowLate) {
      return "Snow developing later";
    }
    if (!snowDay) {
      return "Snow developing overnight";
    }
    if (snow.length >= 8) {
      return "Persistent snow";
    }
    if (snow.length <= 3) {
      return "Intermittent snow showers";
    }
    return "Snow at times";
  }

  // ---------- RAIN ----------
  if (hasRain) {
    const rainEarly = rain.some(h => h < 9);
    const rainLate  = rain.some(h => h >= 15);
    const rainDay   = rain.some(h => h >= 6 && h <= 18);

    if (rainEarly && !rainLate) return "Rain early, clearing later";
    if (!rainEarly && rainLate) return "Rain developing later";
    if (!rainDay) return "Rain developing overnight";
    if (rain.length >= 8) return "Persistent rain";
    return "Rain at times";
  }

  // ---------- CLOUD / CLEAR ----------
  if (clear.length && cloudy.length) {
    return "Cloudy early, clearing later";
  }

  if (cloudy.length > clear.length) {
    return "Overcast";
  }

  if (clear.length > cloudy.length) {
    return "Mostly clear";
  }

  return "Mixed conditions";
}

function summarizePressure(hours) {
  if (!hours || hours.length < 6) return "";

  const start = hours[0].pressure;
  const midIdx = Math.floor(hours.length / 2);
  const mid = hours[midIdx].pressure;
  const end = hours[hours.length - 1].pressure;

  const earlyChange = mid - start;
  const lateChange = end - mid;
  const totalDelta = end - start;

  const abs = Math.abs(totalDelta);
  const deltaStr = `${totalDelta >= 0 ? "+" : ""}${totalDelta.toFixed(2)} inHg`;

  // Minor / noise day
  if (abs < 0.04) {
    return `Mostly steady (minor change ${deltaStr})`;
  }

  // Early rise, then flat (classic post-front pattern)
  if (Math.abs(lateChange) < 0.02 && Math.abs(earlyChange) >= 0.04) {
    const strength =
      abs < 0.08 ? "light" :
      abs < 0.14 ? "moderate" :
      "strong";

    return `Rising early, steady through the day (${strength} change ${deltaStr})`;
  }

  // Clear rise
  if (totalDelta > 0.04) {
    const strength =
      abs < 0.08 ? "light" :
      abs < 0.14 ? "moderate" :
      "strong";

    return `Rising through the day (${strength} change ${deltaStr})`;
  }

  // Clear fall
  if (totalDelta < -0.04) {
    const strength =
      abs < 0.08 ? "light" :
      abs < 0.14 ? "moderate" :
      "strong";

    return `Falling through the day (${strength} drop ${deltaStr})`;
  }

  return `Mostly steady (${deltaStr})`;
}


function formatDateTime(ts) {
  const d = new Date(ts);
  return d.toLocaleString(undefined, {
    weekday: 'short',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
}


function renderHourly(days) {
  const table = document.getElementById("hourly-table");

  if (!Array.isArray(days)) {
    table.innerHTML = "<tr><td>No hourly data available</td></tr>";
    return;
  }

  let html = `
  <thead>
    <tr>
      <th>Day</th>
      <th>Time</th>
      <th>Temp</th>
      <th>Conditions</th>
      <th>Wind</th>
      <th>Gust</th>
      <th>Pressure</th>
    </tr>
  </thead>
`;


  days.forEach((d, idx) => {
    if (!Array.isArray(d.hours) || d.hours.length === 0) return;

    // DAY HEADER (CLICKABLE)
    html += `
  <tbody>
    <tr onclick="toggleHourlyDay(${idx})"
        style="background:#111;cursor:pointer;">
      <td colspan="7"
          style="color:#ff6600;font-weight:bold;padding:10px 8px;">
        ‚ñ∂ ${dayOfWeek(d.date)} ‚Äî ${d.date}
      </td>
    </tr>
  </tbody>

  <tbody id="hourly-day-${idx}" style="display:none">
`;


    let prevPressure = null;

    d.hours.forEach(h => {
      let arrow = "‚Üí";
      if (prevPressure !== null) {
        if (h.pressure > prevPressure) arrow = "‚Üë";
        else if (h.pressure < prevPressure) arrow = "‚Üì";
      }
      prevPressure = h.pressure;

      html += `
        <tr>
          <td></td>
          <td>${h.time}</td>
          <td>${h.temp}¬∞</td>
          <td>${h.conditions}</td>
          <td>
            <span class="wind-arrow"
              style="transform:rotate(${(h.wind_deg + 180) % 360}deg)">‚Üë</span>
            ${h.wind_speed} mph ${h.wind_dir}
          </td>
          <td>${h.gust} mph</td>
          <td>${h.pressure} inHg ${arrow}</td>
        </tr>
      `;
    });

    html += `</tbody>`;
  });

  table.innerHTML = html;
}
function toggleHourlyDay(idx) {
  const block = document.getElementById(`hourly-day-${idx}`);
  if (!block) return;

  block.style.display =
    block.style.display === "none" ? "table-row-group" : "none";
}


function renderAlerts(alerts) {
  const card = document.getElementById("alert-card");
  const body = document.getElementById("alert-body");
  const count = document.getElementById("alert-count");

  if (!alerts || alerts.length === 0) {
    card.style.display = "none";
    return;
  }

  count.textContent = `(${alerts.length})`;
  body.style.display = "block";

  let html = "";

  alerts.forEach(a => {
    let cls = "alert-advisory";
    const sev = (a.severity || "").toLowerCase();
    if (sev.includes("warning")) cls = "alert-warning";
    else if (sev.includes("watch")) cls = "alert-watch";

    html += `
      <div class="alert-item ${cls}">
        <strong>${a.event}</strong><br>
        <em>${a.headline}</em><br>
        <small>${a.onset} ‚Üí ${a.ends}</small>
        <p>${a.description}</p>
      </div>
    `;
  });

  body.innerHTML = html;
  card.style.display = "block";
}

function getWeather() {
  const zip = document.getElementById("zip").value.trim();
  if (!zip) return;
// üîë RESET alerts immediately on new ZIP
  const alertCard = document.getElementById("alert-card");
  const alertBody = document.getElementById("alert-body");
  const alertCount = document.getElementById("alert-count");

  if (alertCard) alertCard.style.display = "none";
  if (alertBody) alertBody.innerHTML = "";
  if (alertCount) alertCount.textContent = "";
fetch("/weather", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ zip })
})
.then(r => r.json())
.then(data => {
  renderAlerts(data.alerts);

  renderCurrent(data.current);
  renderToday(data.today, data.ten_day[0].hours);
  renderStorm(data.storm);
  renderHourly(data.ten_day);
  renderTenDay(data.ten_day);
});

}


/* RENDERERS */

function renderCurrent(n) {
  document.getElementById("current-content").innerHTML = `
    <div>
      <div class="label">Temperature</div>
      <div class="value">${n.temp}¬∞ (Feels ${n.feels}¬∞)</div>
    </div>

    <div>
      <div class="label">Conditions</div>
      <div class="value">${n.conditions}</div>
    </div>

    <div>
      <div class="label">Wind</div>
      <div class="value">
        ${n.wind_speed} mph ${n.wind_dir}
        <span style="color:#aaa;font-size:13px;">(gust ${n.wind_gust} mph)</span>
      </div>
    </div>

    <div>
      <div class="label">Pressure</div>
      <div class="value">${n.pressure} inHg ${n.pressure_trend.icon}</div>
    </div>
  `;
}
function summarizeWind(hours) {
  if (!hours || hours.length < 6) return "Unavailable";

  const speeds = hours.map(h => h.wind_speed);
  const max = Math.max(...speeds);
  const min = Math.min(...speeds);

  const midIdx = Math.floor(hours.length / 2);
  const early = speeds.slice(0, midIdx);
  const late  = speeds.slice(midIdx);

  const earlyMax = Math.max(...early);
  const lateMin  = Math.min(...late);

  if (max <= 6) {
    return `Light and steady (${max} mph max)`;
  }

  if (earlyMax >= 9 && lateMin <= 5) {
    return `Windy early, calming later (${earlyMax} ‚Üí ${lateMin} mph)`;
  }

  if (max <= 10 && (max - min) <= 4) {
    return `Moderate and consistent (${min}‚Äì${max} mph)`;
  }

  if ((max - min) >= 8) {
    return `Variable with gusty periods (${min}‚Äì${max} mph)`;
  }

  return `Moderate with variability (${min}‚Äì${max} mph)`;
}

function renderToday(n, hours) {

  const windSummary = summarizeWind(hours);
  const pressureSummary = summarizePressure(hours);

  // Interpret the entire day from hourly data
  const dayCondition = summarizeDayConditions(hours);

  // Look up definition (guaranteed by glossary)
  const conditionDef =
    CONDITIONS_DEFINITIONS[dayCondition] || "";

  document.getElementById("today-content").innerHTML = `
    <div>
      <div class="label">Conditions</div>
      <div class="value">
        ${dayCondition}
        <div style="
          color:#aaa;
          font-size:13px;
          margin-top:4px;
          font-weight:400;
          line-height:1.4;
        ">
          ${conditionDef}
        </div>
      </div>
    </div>

    <div>
      <div class="label">High / Low</div>
      <div class="value">${n.high}¬∞ / ${n.low}¬∞</div>
    </div>

    <div class="light-panel">
      <div class="label">First Light</div>
      <div class="value">${n.first_light}</div>

      <div class="label">Sunrise</div>
      <div class="value">${n.sunrise}</div>

      <div class="label">Sunset</div>
      <div class="value">${n.sunset}</div>

      <div class="label">Last Light</div>
      <div class="value">${n.last_light}</div>

      <div class="label light-divider">Total Daylight</div>
      <div class="value light-divider">${n.daylight}</div>
    </div>

    <div style="grid-column:1 / -1; margin-top:10px; font-size:14px;">
      <div><strong>Wind:</strong> ${windSummary}</div>
      <div><strong>Pressure:</strong> ${pressureSummary}</div>
    </div>
  `;
}


function renderStorm(storm) {
  const el = document.getElementById("storm-content");

  if (!storm || storm.type !== "Snow") {
    el.style.display = "none";
    el.innerHTML = "";
    return;
  }

  const now = new Date();

  const endOfToday = new Date(
    now.getFullYear(),
    now.getMonth(),
    now.getDate(),
    23, 59, 59
  );

  // Look ahead 24 hours (overnight snow)
  const lookAheadEnd = new Date(now.getTime() + 24 * 60 * 60 * 1000);

  const eventStart = new Date(storm.start);
  const eventEnd   = new Date(storm.end);

  // OPTION B: relevant snow
  const isRelevant =
    eventEnd >= now &&
    eventStart <= lookAheadEnd;

  if (!isRelevant) {
    el.style.display = "none";
    el.innerHTML = "";
    return;
  }

  let label = "Snow Event";
  if (eventStart <= endOfToday) {
    label = "Snow Event Today";
  } else {
    label = "Snow Event Overnight / Tomorrow";
  }

  el.style.display = "block";
  el.innerHTML = `
    <div style="
      border-top:1px solid #333;
      padding-top:10px;
      font-size:14px;
      color:#ddd;
    ">
      ‚ùÑÔ∏è <strong>${label}</strong>
      Starts <strong>${formatDateTime(eventStart)}</strong>
      Ends <strong>${formatDateTime(eventEnd)}</strong>
      <span style="color:#aaa;">Total Expected ${storm.snow}"</span>
    </div>
  `;
}

function dayOfWeek(dateStr) {
  const d = new Date(dateStr + "T00:00:00");
  return d.toLocaleDateString("en-US", { weekday: "short" });
}

function renderTenDay(days) {
  let html = `
    <tr>
      <th>Day / Date</th>
      <th>High</th>
      <th>Low</th>
      <th>Wind</th>
      <th>Moon</th>
      <th>Conditions</th>
    </tr>
  `;

  days.forEach(d => {

    // MAIN WEATHER ROW
    html += `
      <tr>
        <td data-label="Day / Date">
          <strong>${dayOfWeek(d.date)}</strong>
          <span style="color:#aaa;margin-left:6px;">${d.date}</span>
        </td>

        <td data-label="High">${d.high}¬∞</td>
        <td data-label="Low">${d.low}¬∞</td>

        <td data-label="Wind">
          <span class="wind-arrow"
                style="transform:rotate(${(d.wind_deg + 180) % 360}deg)">‚Üë</span>
          ${d.wind_dir}
        </td>

        <td data-label="Moon">
          ${d.moon.icon}
          <span style="font-size:13px;color:#aaa;">
            ${d.moon.illum}%
          </span>
        </td>

        <td data-label="Conditions">${d.conditions}</td>
      </tr>
    `;

    // DAYLIGHT ROW (ALWAYS VISIBLE)
    html += `
      <tr class="daylight-row">
        <td colspan="6" data-label="Daylight" style="padding:8px 10px 12px;color:#aaa;">
          <div style="
            display:flex;
            gap:16px;
            flex-wrap:wrap;
            font-size:13px;
          ">
            <div><strong>First Light</strong> ${d.first_light}</div>
            <div><strong>Sunrise</strong> ${d.sunrise}</div>
            <div><strong>Sunset</strong> ${d.sunset}</div>
            <div><strong>Last Light</strong> ${d.last_light}</div>
            <div><strong>Total Daylight</strong> ${d.daylight}
            </div>
          </div>
        </td>
      </tr>
    `;

  });

  document.getElementById("ten-day-table").innerHTML = html;
}



</script>

</body>
</html>
