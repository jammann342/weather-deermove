<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BBR Weather</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  background: #0b0b0b;
  color: #eaeaea;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

header {
  padding: 20px;
  text-align: center;
}

h1 {
  color: #ff6600;
  margin-bottom: 10px;
}

/* ZIP INPUT */
.zip-wrap {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-bottom: 15px;
}

.zip-wrap input {
  background: #111;
  color: #fff;
  border: 1px solid #ff6600;
  border-radius: 6px;
  padding: 8px 10px;
  width: 120px;
  font-size: 14px;
}

.zip-wrap input::placeholder {
  color: #888;
}

.zip-wrap button {
  background: #ff6600;
  color: #000;
  border: none;
  border-radius: 6px;
  padding: 8px 14px;
  font-weight: bold;
  cursor: pointer;
}

.zip-wrap button:hover {
  background: #ff7a1a;
}

/* TOGGLES */
.toggle-bar {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 15px;
}

.toggle-bar button {
  background: #1a1a1a;
  color: #fff;
  border: 1px solid #333;
  padding: 6px 14px;
  border-radius: 6px;
  cursor: pointer;
}

.toggle-bar button.active {
  background: #ff6600;
  color: #000;
  border-color: #ff6600;
}

/* CARDS */
.card {
  max-width: 900px;
  margin: 0 auto 20px;
  background: #222;
  border: 1px solid #ff6600;
  border-radius: 10px;
  padding: 16px;
}

.card h2 {
  margin-top: 0;
  color: #ff6600;
}

/* NOW GRID */
.now-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 14px;
  margin-top: 10px;
}

.label {
  color: #aaa;
  font-size: 12px;
}

.value {
  font-size: 16px;
  font-weight: 600;
}

/* TABLE */
table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 8px;
  border-bottom: 1px solid #333;
  text-align: left;
}

th {
  color: #ff6600;
  font-weight: 600;
}
/* LIGHT STACK (NOW CARD RIGHT SIDE) */
.light-stack {
  display: flex;
  flex-direction: column;
  gap: 12px;
  text-align: center;
}

.light-pair {
  display: flex;
  justify-content: center;
  gap: 28px;
}

.light-single {
  text-align: center;
}
.light-panel {
  display: grid;
  grid-template-columns: auto auto;
  column-gap: 18px;
  row-gap: 8px;
  align-items: center;
}

.light-panel .label {
  text-align: right;
}

.light-panel .value {
  text-align: left;
}

/* divider + emphasis for total daylight */
.light-divider {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid #333;
}

.wind-arrow {
  display: inline-block;
  font-size: 14px;
  color: #ff6600;
  margin-right: 6px;
  transform-origin: center;
}


</style>
</head>

<body>

<header>
  <h1>BBR Weather</h1>

  <form class="zip-wrap" onsubmit="getWeather(); return false;">
  <input
    type="text"
    id="zip"
    placeholder="ZIP code"
    maxlength="5"
    inputmode="numeric"
  >
  <button type="submit">Go</button>
</form>


  <div class="toggle-bar">
    <button id="btn-now" class="active" onclick="showView('now')">NOW</button>
    <button id="btn-hourly" onclick="showView('hourly')">HOURLY</button>
    <button id="btn-10day" onclick="showView('10day')">10-DAY</button>
  </div>
</header>

<!-- NOW -->
<div id="view-now" class="card">
  <h2>Current Conditions</h2>
  <div class="now-grid" id="now-content"></div>
</div>

<!-- HOURLY -->
<div id="view-hourly" class="card" style="display:none">
  <h2>Hourly Forecast</h2>
  <table id="hourly-table"></table>
</div>

<!-- 10 DAY -->
<div id="view-10day" class="card" style="display:none">
  <h2>10-Day Outlook</h2>
  <table id="ten-day-table"></table>
</div>

<script>
function showView(view) {
  ["now","hourly","10day"].forEach(v => {
    document.getElementById(`view-${v}`).style.display = (v === view) ? "block" : "none";
    document.getElementById(`btn-${v === "10day" ? "10day" : v}`).classList.toggle("active", v === view);
  });
}
function renderHourly(days) {
  const table = document.getElementById("hourly-table");

  if (!Array.isArray(days)) {
    table.innerHTML = "<tr><td>No hourly data available</td></tr>";
    return;
  }

  let html = `
    <tr>
      <th>Day</th>
      <th>Time</th>
      <th>Temp</th>
      <th>Conditions</th>
      <th>Wind</th>
      <th>Gust</th>
      <th>Pressure</th>
    </tr>
  `;

  days.forEach((d, idx) => {
    if (!Array.isArray(d.hours) || d.hours.length === 0) return;

    // DAY HEADER (CLICKABLE)
    html += `
      <tr onclick="toggleHourlyDay(${idx})"
          style="background:#111;cursor:pointer;">
        <td colspan="7"
            style="color:#ff6600;font-weight:bold;padding:10px 8px;">
          ▶ ${dayOfWeek(d.date)} — ${d.date}
        </td>
      </tr>
    `;

    html += `<tbody id="hourly-day-${idx}" style="display:none">`;

    let prevPressure = null;

    d.hours.forEach(h => {
      let arrow = "→";
      if (prevPressure !== null) {
        if (h.pressure > prevPressure) arrow = "↑";
        else if (h.pressure < prevPressure) arrow = "↓";
      }
      prevPressure = h.pressure;

      html += `
        <tr>
          <td></td>
          <td>${h.time}</td>
          <td>${h.temp}°</td>
          <td>${h.conditions}</td>
          <td>
            <span class="wind-arrow"
              style="transform:rotate(${(h.wind_deg + 180) % 360}deg)">↑</span>
            ${h.wind_speed} mph ${h.wind_dir}
          </td>
          <td>${h.gust} mph</td>
          <td>${h.pressure} inHg ${arrow}</td>
        </tr>
      `;
    });

    html += `</tbody>`;
  });

  table.innerHTML = html;
}
function toggleHourlyDay(idx) {
  const block = document.getElementById(`hourly-day-${idx}`);
  if (!block) return;

  block.style.display =
    block.style.display === "none" ? "table-row-group" : "none";
}


function getWeather() {
  const zip = document.getElementById("zip").value.trim();
  if (!zip) return;

fetch("/weather", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ zip })
})
.then(r => r.json())
.then(data => {
  renderNow(data.now);
  renderHourly(data.ten_day);
  renderTenDay(data.ten_day);
});
}

function toggleDay(idx) {
  const row = document.getElementById(`day-${idx}`);
  if (!row) return;

  row.style.display =
    row.style.display === "none" ? "table-row" : "none";
}


/* RENDERERS */

function renderNow(n) {
  document.getElementById("now-content").innerHTML = `
    <div><div class="label">Temperature</div><div class="value">${n.temp}° (Feels ${n.feels}°)</div></div>
    <div><div class="label">Conditions</div><div class="value">${n.conditions}</div></div>
    <div><div class="label">High / Low</div><div class="value">${n.high}° / ${n.low}°</div></div>
    <div>
  <div class="label">Wind</div>

  <svg viewBox="0 0 100 100" width="90" height="90" style="display:block;margin:4px 0;">
    <circle cx="50" cy="50" r="45" stroke="#ff6600" stroke-width="2" fill="none"/>
    <line
      x1="50" y1="50" x2="50" y2="10"
      stroke="red" stroke-width="4"
      transform="rotate(${n.wind_deg} 50 50)"
    />
  </svg>

  <div class="value">
    ${n.wind_speed} mph ${n.wind_dir}
    <span style="color:#aaa;font-size:13px;">(gust ${n.wind_gust} mph)</span>
  </div>
</div>

    <div>
  <div class="label">Pressure</div>
  <div class="value">
    ${n.pressure} inHg ${n.pressure_trend.icon}
  </div>
</div>
<div class="light-panel">
  <div class="label">First Light</div>
  <div class="value">${n.first_light}</div>

  <div class="label">Sunrise</div>
  <div class="value">${n.sunrise}</div>

  <div class="label">Sunset</div>
  <div class="value">${n.sunset}</div>

  <div class="label">Last Light</div>
  <div class="value">${n.last_light}</div>

  <div class="label light-divider">Total Daylight</div>
  <div class="value light-divider">${n.daylight}</div>
</div>


  `;
}



function dayOfWeek(dateStr) {
  const d = new Date(dateStr + "T00:00:00");
  return d.toLocaleDateString("en-US", { weekday: "short" });
}


function renderTenDay(days) {
  let html = `
    <tr>
      <th>Day / Date</th>
      <th>High</th>
      <th>Low</th>
      <th>Wind</th>
	  <th>Moon</th>
      <th>Conditions</th>
    </tr>
  `;

  days.forEach((d, i) => {
    html += `
      <tr onclick="toggleDay(${i})" style="cursor:pointer">
        <td>
          <strong>${dayOfWeek(d.date)}</strong>
          <span style="color:#aaa;margin-left:6px;">${d.date}</span>
        </td>
        <td>${d.high}°</td>
        <td>${d.low}°</td>
        <td>
          <span class="wind-arrow"
                style="transform:rotate(${(d.wind_deg + 180) % 360}deg)">↑</span>
          ${d.wind_dir}
        </td>
        <td>
	  ${d.moon.icon}
	  <span style="font-size:13px;color:#aaa;">
		${d.moon.illum}%
	  </span>
	</td>
		<td>${d.conditions}</td>

      </tr>

      <tr id="day-${i}" style="display:none">
        <td colspan="6" style="padding:10px;color:#aaa">
          Hourly forecast will go here
        </td>
      </tr>
    `;
  });

  document.getElementById("ten-day-table").innerHTML = html;
}




</script>

</body>
</html>
